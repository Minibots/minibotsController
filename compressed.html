<!DOCTYPE HTML> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <style> html, body{ margin:0;height:100%;}#buttonController{ }#joystickController{ padding:0;top:0;bottom:0;left:0;right:0;position:absolute;text-align:center;}#controllerTable{ position:absolute;top:0;bottom:0;left:0;right:0;height:100%;width:100%;}.controllerButton{ background-color:red;border:1px solid black;text-align:center;width:33.33333333333%;height:33.33333333333%;}#bottomGoBackButton{ position:fixed;bottom:0;left:0;}#homeScreen{ margin:8px;text-align:center;}#homeScreenTable{ margin-left:auto;margin-right:auto;}#controllerJoystickCanvas{ display:inline;}#keyboardController{ margin:8px;}#directionalStatus{ margin:8px;text-align:center;font-size:24px;}</style> <style> </style> </head> <body> <div id="homeScreen"> Hello! Welcome to the minibot controller. Please select a method of controlling your minibot! <table id="homeScreenTable"> <tr> <td><button id="goToJoystick">Joystick</button></td> <td><button id="goToButtons">Buttons</button></td> </tr> <tr> <td><button id="goToKeyboard">Keyboard</button></td> <td><button id="goToSettings">Settings</button></td> </tr> </table> </div> <div id="buttonController"> <table id="controllerTable"> <tr> <td></td> <td id="forwardButton" class="controllerButton">Forward</td> <td></td> </tr> <tr> <td id="leftButton" class="controllerButton">Left</td> <td id="stopButton" class="controllerButton">Stop</td> <td id="rightButton" class="controllerButton">Right</td> </tr> <tr> <td id="goBackButton" class="controllerButton">Go Back to Main Page</td> <td id="reverseButton" class="controllerButton">Reverse</td> <td></td> </tr> </table> </div> <div id="joystickController"> <canvas id="controllerJoystickCanvas"> </canvas> <button id="bottomGoBackButton">Go Back</button> </div> <div id="keyboardController"> Your keyboard can be a controller as well! <table> <tr> <td>Up:</td> <td>UpArrow</td> <td>or</td> <td>W</td> </tr> <tr> <td>Down:</td> <td>DownArrow</td> <td>or</td> <td>S</td> </tr> <tr> <td>Left:</td> <td>LeftArrow</td> <td>or</td> <td>A</td> </tr> <tr> <td>Right:</td> <td>RightArrow</td> <td>or</td> <td>D</td> </tr> <td>Stop:</td> <td>Space</td> </table> <br><br> <div id="directionalStatus"> This </div> </div> </body> </html> <script type="text/javascript">function hideElement(e){document.getElementById(e).style.visibility="collapse"}function showElement(e){document.getElementById(e).style.visibility="visible"}function functReset(e,o){var t=Math.min(window.innerWidth,window.innerHeight);context.canvas.width=4*t/5,context.canvas.height=4*t/5,drawBackground(),drawCenter(e,o)}function drawBackground(){var e=Math.min(canvas.width,canvas.height);context.beginPath(),context.lineWidth=4,context.arc(e/2,e/2,e/3,0,2*Math.PI),context.stroke()}function drawCenter(e,o){var t=Math.min(canvas.width,canvas.height);e==-1&&o==-1&&(e=t/2,o=t/2),context.beginPath(),context.lineWidth=3,context.arc(e,o,t/8,0,2*Math.PI),context.stroke()}function controllerDown(){functReset(-1,-1),moveRobot(0,0),clicked=!0}function controllerUp(){console.log("visible"!=document.getElementById("joystickController")),"visible"==document.getElementById("joystickController"),functReset(-1,-1),moveRobot(0,0),clicked=!1}function controllerMove(e){var o=mousePosition(canvas,e,mouse);moveController(o)}function moveController(e){var o=Math.min(canvas.width,canvas.height);functReset(e.x,e.y);var t=-(e.y-o/2)/(o/3),n=(e.x-o/2)/(o/3),c=100*n+100*t,l=-100*n+100*t;c>100&&(c=100),c<-100&&(c=-100),l>100&&(l=100),l<-100&&(l=-100),null!=c&&null!=l&&(moveRobot(c,l),count=0)}function mousePosition(e,o,t){var n=e.getBoundingClientRect();if(t)return{x:o.clientX-n.left,y:o.clientY-n.top};var c=o.targetTouches[0];return console.log(n.left),{x:c.pageX-n.left,y:c.pageY-n.top}}function moveRobot(e,o){var t="left="+e+"&right="+o;postData("/command",t,function(e){console.log(e)}),console.log(t)}function postData(e,o,t){var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&200==n.status&&t(n.responseText)},n.send(o)}hideElement("buttonController"),hideElement("joystickController"),hideElement("keyboardController");var canvas=document.getElementById("controllerJoystickCanvas"),context=canvas.getContext("2d"),count=0;context.fillStyle="#FF0000",context.fillRect(0,0,1400,400),functReset(-1,-1),window.onresize=function(e){functReset(-1,-1)};var clicked=!1,mouse=!0;document.getElementById("controllerJoystickCanvas").onmousedown=function(){mouse&&controllerDown()},window.onmouseup=function(){mouse&&controllerUp()},document.getElementById("controllerJoystickCanvas").onmousemove=function(e){mouse=!0,clicked&&controllerMove(e)};var joy=document.getElementById("controllerJoystickCanvas");joy.addEventListener("touchstart",controllerDown,!1),joy.addEventListener("touchend",controllerUp,!1),joy.addEventListener("touchcancel",controllerUp,!1),joy.addEventListener("touchmove",controllerMove,!1),joy.addEventListener("touchmove",function(){mouse=!1},!1),document.getElementById("rightButton").onclick=function(){moveRobot(-100,100)},document.getElementById("forwardButton").onclick=function(){moveRobot(100,100)},document.getElementById("stopButton").onclick=function(){moveRobot(0,0)},document.getElementById("leftButton").onclick=function(){moveRobot(100,-100)},document.getElementById("reverseButton").onclick=function(){moveRobot(-100,-100)},document.getElementById("goBackButton").onclick=function(){hideElement("buttonController"),showElement("homeScreen")},document.getElementById("bottomGoBackButton").onclick=function(){hideElement("joystickController"),showElement("homeScreen")},document.getElementById("goToButtons").onclick=function(){showElement("buttonController"),hideElement("homeScreen")},document.getElementById("goToJoystick").onclick=function(){showElement("joystickController"),hideElement("homeScreen")},document.getElementById("goToKeyboard").onclick=function(){showElement("keyboardController"),hideElement("homeScreen")},document.getElementById("goToSettings").onclick=function(){showElement("joystickController"),hideElement("homeScreen")},window.onkeydown=function(e){console.log("asdf"),console.log(e.keyCode),39!=e.keyCode&&68!=e.keyCode||moveRobot(-100,100),38!=e.keyCode&&87!=e.keyCode||moveRobot(100,100),32==e.keyCode&&moveRobot(0,0),37!=e.keyCode&&65!=e.keyCode||moveRobot(100,-100),40!=e.keyCode&&83!=e.keyCode||moveRobot(-100,-100)};</script>