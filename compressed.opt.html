<!DOCTYPE HTML> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <style> html{ margin:0;height:100%;}#b{ padding:0;top:0;bottom:0;left:0;right:0;position:absolute;text-align:center;}#j{ position:absolute;top:0;bottom:0;left:0;right:0;height:100%;width:100%;}.a{ background-color:red;border:1px solid black;text-align:center;width:33.33333333333%;height:33.33333333333%;}#d{ position:fixed;bottom:0;left:0;display:none;}#x{ margin:8px;text-align:center;}#k{ margin-left:auto;margin-right:auto;}#c{ display:inline;}#a{ margin:8px;}#e{ margin:8px;text-align:center;font-size:24px;}#i{ display:none;}#b{ display:none;}#a{ display:none;}#m{ text-align:center;}#h{ text-align:center;display:none;}.b{ font-size:small;}#q{ position:fixed;bottom:0;//text-align:right;width:100%;}#f{ float:right;margin-right:10px;}</style> <title>Minibots Controller</title> </head> <body> <div id="x"> Hello! Welcome to the minibot controller. Please select a method of controlling your minibot! <table id="k"> <tr> <td><button id="u">Joystick</button></td> <td><button id="v">Buttons</button></td> </tr> <tr> <td><button id="s">Keyboard</button></td> <td><button id="p">Settings</button></td> </tr> </table> </div> <div id="i"> <table id="j"> <tr> <td></td> <td id="l" class="a">Forward</td> <td></td> </tr> <tr> <td id="z" class="a">Left</td> <td id="y" class="a">Stop</td> <td id="w" class="a">Right</td> </tr> <tr> <td id="r" class="a">Go Back to Main Page</td> <td id="n" class="a">Reverse</td> <td></td> </tr> </table> </div> <div id="b"> <canvas id="c"> </canvas> </div> <div id="a"> Your keyboard can be a controller as well! <div class="b"> <table> <tr> <td>Up:</td> <td>UpArrow</td> <td>or</td> <td>W</td> </tr> <tr> <td>Down:</td> <td>DownArrow</td> <td>or</td> <td>S</td> </tr> <tr> <td>Left:</td> <td>LeftArrow</td> <td>or</td> <td>A</td> </tr> <tr> <td>Right:</td> <td>RightArrow</td> <td>or</td> <td>D</td> </tr> <td>Stop:</td> <td>Space</td> </table> </div> <br><br> <div id="e"> This </div> </div> <div id="h"> <h1>Settings</h1> To fix alignment:<br> <input type="range" id="t"><br> <input type="number" id="o"><br> <div class="b"> Negative numbers will pull the robot to the left.<br> Positive numbers will pull the robot to the right. </div> <br> <input type="checkbox" id="g">Forward Only <br> <br> The last command sent to the robot is shown at the bottom of the page!<br> It is shown with the notation (left, right) rounded to the nearest integer.<br> <br> You can find the code for this project <a href="https://github.com/Minibots/minibotsController">here</a>. <br><br> </div> <div id="q"> <button id="d">Go Back</button> <span id="f"></span> </div> </body> </html> <script type="text/javascript">function hideElement(e){document.getElementById(e).style.display="none"}function showElement(e){document.getElementById(e).style.display="block"}function functReset(e,n){var t=Math.min(window.innerWidth,window.innerHeight);context.canvas.width=4*t/5,context.canvas.height=4*t/5,drawBackground(),drawCenter(e,n)}function drawBackground(){var e=Math.min(canvas.width,canvas.height);context.beginPath(),context.lineWidth=4,context.arc(e/2,e/2,e/3,0,2*Math.PI),context.stroke()}function drawCenter(e,n){var t=Math.min(canvas.width,canvas.height);e==-1&&n==-1&&(e=t/2,n=t/2),context.beginPath(),context.lineWidth=3,context.arc(e,n,t/8,0,2*Math.PI),context.stroke()}function controllerDown(){functReset(-1,-1),moveRobot(0,0),clicked=!0}function controllerUp(){"none"!=document.getElementById("b").style.display,functReset(-1,-1),moveRobot(0,0),clicked=!1}function controllerMove(e){var n=mousePosition(canvas,e,mouse);moveController(n)}function moveController(e){var n=Math.min(canvas.width,canvas.height);functReset(e.x,e.y);var t=-(e.y-n/2)/(n/3),o=(e.x-n/2)/(n/3),l=100*o+100*t,c=-100*o+100*t;l>100&&(l=100),l<-100&&(l=-100),c>100&&(c=100),c<-100&&(c=-100),null!=l&&null!=c&&(moveRobot(l,c),count=0)}function mousePosition(e,n,t){var o=e.getBoundingClientRect();if(t)return{x:n.clientX-o.left,y:n.clientY-o.top};var l=n.targetTouches[0];return console.log(o.left),{x:l.pageX-o.left,y:l.pageY-o.top}}function moveRobot(e,n){align<0&&(e*=1+align/100),align>0&&(n*=1-align/100),document.getElementById("g").checked&&(e<0&&(e=0),n<0&&(n=0));var t="left="+e+"&right="+n;document.getElementById("f").innerHTML="("+Math.round(e)+", "+Math.round(n)+")",postData("/command",t,function(e){console.log(e)}),console.log(t)}function postData(e,n,t){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&200==o.status&&t(o.responseText)},o.send(n)}var align;align=localStorage.align?1*localStorage.align:0;var forwardOnly=document.getElementById("g");forwardOnly.checked=!0,"undefined"!=typeof localStorage.forwardOnly&&("true"==localStorage.forwardOnly?forwardOnly.checked=!0:forwardOnly.checked=!1);var alignNumberId=document.getElementById("o");alignNumberId.value=align;var alignRangeId=document.getElementById("t");alignRangeId.value=align+50;var canvas=document.getElementById("c"),context=canvas.getContext("2d"),count=0;functReset(-1,-1),window.onresize=function(e){functReset(-1,-1)};var clicked=!1,mouse=!0;canvas.onmousedown=function(){mouse&&controllerDown()},window.onmouseup=function(){mouse&&controllerUp()},canvas.onmousemove=function(e){mouse=!0,clicked&&controllerMove(e)},canvas.addEventListener("touchstart",controllerDown,!1),canvas.addEventListener("touchend",controllerUp,!1),canvas.addEventListener("touchcancel",controllerUp,!1),canvas.addEventListener("touchmove",controllerMove,!1),canvas.addEventListener("touchmove",function(){mouse=!1},!1),document.getElementById("w").onclick=function(){moveRobot(100,-100)},document.getElementById("l").onclick=function(){moveRobot(100,100)},document.getElementById("y").onclick=function(){moveRobot(0,0)},document.getElementById("z").onclick=function(){moveRobot(-100,100)},document.getElementById("n").onclick=function(){moveRobot(-100,-100)},document.getElementById("r").onclick=function(){hideElement("buttonController"),showElement("homeScreen"),hideElement("bottomGoBackButton")},document.getElementById("d").onclick=function(){hideElement("joystickController"),hideElement("buttonController"),hideElement("keyboardController"),hideElement("settingsController"),showElement("homeScreen"),hideElement("bottomGoBackButton")},document.getElementById("v").onclick=function(){showElement("buttonController"),hideElement("homeScreen"),hideElement("bottomGoBackButton")},document.getElementById("u").onclick=function(){showElement("joystickController"),hideElement("homeScreen"),showElement("bottomGoBackButton")},document.getElementById("s").onclick=function(){showElement("keyboardController"),hideElement("homeScreen"),showElement("bottomGoBackButton")},document.getElementById("p").onclick=function(){showElement("settingsController"),hideElement("homeScreen"),showElement("bottomGoBackButton")},alignRangeId.onchange=function(){align=alignNumberId.value=alignRangeId.value-50,localStorage.align=align},alignNumberId.onchange=function(){alignRangeId.value=(align=1*alignNumberId.value)+50,localStorage.align=align},forwardOnly.onchange=function(){localStorage.forwardOnly=forwardOnly.checked},window.onkeydown=function(e){"none"!=document.getElementById("a").style.display&&(39!=e.keyCode&&68!=e.keyCode||moveRobot(-100,100),38!=e.keyCode&&87!=e.keyCode||moveRobot(100,100),32==e.keyCode&&moveRobot(0,0),37!=e.keyCode&&65!=e.keyCode||moveRobot(100,-100),40!=e.keyCode&&83!=e.keyCode||moveRobot(-100,-100),document.getElementById("e").innerHTML=e.keyCode)};</script>